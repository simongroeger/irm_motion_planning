<!DOCTYPE html>
<html lang="en"> 
<head>
    <title>Motion Planning in RKHS</title>
    
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Blog Template">
    <meta name="author" content="Xiaoying Riley at 3rd Wave Media">    
    <link rel="shortcut icon" href="favicon.ico"> 
    
    <!-- FontAwesome JS-->
	<script defer src="assets/fontawesome/js/all.min.js"></script>
    
    <!-- Plugin CSS -->
    <link rel="stylesheet" href="assets/plugins/highlight/styles/monokai-sublime.css">
    
    <!-- Theme CSS -->  
    <link id="theme-style" rel="stylesheet" href="assets/css/theme-1.css">
    
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head> 

<body>
    
    <header class="header text-center">	    
	    <h1 class="blog-name pt-lg-4 mb-0"><a class="no-text-decoration" >Simon's Blog</a></h1>
        
	    <nav class="navbar navbar-expand-lg navbar-dark" >
           
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div id="navigation" class="collapse navbar-collapse flex-column" >
				<div class="profile-section pt-3 pt-lg-4">
				    <img class="profile-image mb-3 rounded-circle mx-auto" src="assets/images/profile.jpg" alt="image" >			
					
					<div class="bio mb-3">Hi, my name is Simon Gröger. I am a student in my computer science master at TU Darmstadt and currently working on a  trajectory optimization project.<br></div><!--//bio-->
					<hr> 
				</div><!--//profile-section-->
			</div>
		</nav>
    </header>
    
    <div class="main-wrapper">
	    
<article class="blog-post px-3 py-5 p-md-5">
	<div class="container single-col-max-width">


<!-- 
Actual content 
..........................................................................
..........................................................................
..........................................................................
..........................................................................
..........................................................................
..........................................................................
..........................................................................
-->

<header class="blog-post-header">
	<h2 class="title mb-2">Motion Planning in RKHS</h2>
	<div class="meta mb-3"><span class="date">Intelligent Robotic Manipulation Project Lab II</span><span class="date">April 24 - September 24</span><span class="date">Simon Gröger</span></div>
</header>
			    
<div class="blog-post-body">
<figure class="blog-banner">
	<img class="img-fluid" src="assets/images/Figure_2.png" alt="image">
	<figcaption class="mt-2 text-center image-caption">Trajectory Optimization with a 3-link-robot</figcaption>
</figure>


<p> 
	In this project the goal is a fast motion planning approach using the Reproducing Kernel Hilbert Space. 
	This approach may lead to better results as the problem formulation has fewer local optima.
	
</p>

<h3 class="mt-5 mb-3">Introduction</h3>

<p>

	In motion planning trajectories are often defined in the Reproducing Kernel Hilbert Space (RKHS). The Trajectory is intialized in a straight line from start to goal configuration and then the cost of the trajectory is minimized using functional gradient descent thus avoiding the obstacles

</p>

<h3 class="mt-5 mb-3">Math</h3>

<h4 class="mt-3 mb-3">Trajectory Formulation</h4>

<p> 

	The trajectory is defined in the reproducing kernel hilbert space and has a parameter matrix \(\alpha\), a Kernel matrix K and an additional matrix J. 
	The kernel matrix uses the RBF kernel and the matrix J enables cross joint communticaion and optimization.
	The trajectory can be evaluated to the jointposition for any timestep t using $$ evaluate(K, J, \alpha, t) = K(\cdot, t) \alpha J $$
	During the trajectory optimzation a finite set of supporting points \( t_i \) for \( i \in \{1,...,n_{support}\} \) are used.

	

</p>

<h4 class="mt-3 mb-3">Loss Formulation</h4>

<p> 

	The trajectory optimization problem has a constraint loss, with the loss of the trajectory in the cost map and multiple trajectory constraints.
	The trajectory constraints define the distance of the start and final configuration to the start and end of the trajectory. Also the joint position and velocity are limited to the respective max and min constraints.

	Therefore the constraint optimization problem formulation is the following:

	\[ \min_{\alpha} L(\alpha) = \sum_{i=1}^{n_{support}} \sum_{j=1}^{n_{joints}} costmap( fk_j(evaluate(K, J, \alpha, t_i) ) + \lambda_{reg} || evaluate(K, J, \alpha, \cdot) ||^2 \]
	s.t. 
	\[ || evaluate(K, J, \alpha, t_1)  - config_{start} || \le \epsilon_{position}  \]
	\[ || evaluate(K, J, \alpha, t_{n_{support}}) - config_{goal} || \le \epsilon_{position}  \]
	\[ || {\partial \over \partial t} evaluate(K, J, \alpha, t) || \le \epsilon_{velocity}  \]
	\[ || {\partial \over \partial t} evaluate(K, J, \alpha, t_{n_{support}}) || \le \epsilon_{velocity}  \]
	\[ \forall i \in \{1,...,n_{support}\} : evaluate(K, J, \alpha, t_i) \le jointposition_{max}  \]
	\[ \forall i \in \{1,...,n_{support}\} : evaluate(K, J, \alpha, t_i) \ge jointposition_{min}  \]
	\[ \forall i \in \{1,...,n_{support}\} : | {\partial \over \partial t}  evaluate(K, J, \alpha, t_i) | \le jointvelocity_{max}  \]

 
</p>

<h4 class="mt-3 mb-3">Constraint Gradient update</h4>

During optimization the constraint loss is transformed to a Lagragian formulation and optimized using the Squared Penalty Method with increasing the  lagragian multiplier by an order of magnitude when the current loss was minimized.

In the optimization process the obstacle loss is adjusted to overcome local optima and improve convergence.
The used obstacle loss combines the average and the maximum trajectory loss for the supporting points with a hyperparameter \( \lambda_{cost} \) and is defined as follows:

\[ ObstacleLoss(\alpha) = 
         \lambda_{cost} \max_{i=1}^{n_{support}} \sum_{j=1}^{n_{joints}} costmap( fk_j(evaluate(K, J, \alpha, t_i) )
  + (1 - \lambda_{cost}) {1 \over n_{support}} \sum_{i=1}^{n_{support}} \sum_{j=1}^{n_{joints}} costmap( fk_j(evaluate(K, J, \alpha, t_i) ) \]




<p> 

</p>

<h4 class="mt-5 mb-3">Equation Derivation</h4>
<h4 class="mt-5 mb-3">Algorithmic Pipeline Derivation</h4>
<h5 class="mt-5 mb-3">Pseudocode with linenumbers</h5>

<p> Ich bin ein Text. </p>

<pre>
<code>
alpha, K, dK, J = initialize_trajectory()

while not constraint_fulfilled(alpha, K, dK, J) or n_outer==0 do

	while last_loss_reduction > eps do

		compute constraint_loss
		compute gradient
		lr = find optimal backtracking line search learning rate
		update trajectory: alpha = 

	
</code>
</pre>

<h3 class="mt-5 mb-3">Experiments</h3>

<p> Current Environment explanation</p>


<p> Videos</p>

<p> Runtime for different problems, GD / BLSGD, joint constraints pytorch, jax Gradient descent, jax line search  </p>

<h5 class="mt-5 mb-3">Insights on failed ideas</h5>

<p> 
	Reformulating the obstacle loss part and including the max part of the loss was very crucial as the model was else stuck in a local optima, seen in the following figure, and didnt converge to the optimal solution. Apparently the gradient of the part of the trajectory close to the obstacles is not big enough to overcome the cost of the constraints and the smoothness cost.

</p>

<figure class="blog-banner">
	<img class="img-fluid" src="assets/images/Figure_nomax.png" alt="image">
	<figcaption class="mt-2 text-center image-caption">Result of the Trajectory Optimization when not using the adjusted obstacle loss</figcaption>
</figure>


<p>
	The original paper sugested using the Jacobian matrix in the trajectory formulation to enable joint optimization with communication across different joints influencing each other. In our experiments the optimization didnt work anymore if we included the actual Jacobian matrix as the magnitude of the entries was very different. Naturally the elements for the first joint are larger than those of the last joints, which makes any optimization very hard.
	We therefore used a identity matrix and added N(0, 0.2) to the elements to enable random cross joint communication.
</p>

<p>

</p>

<h3 class="mt-5 mb-3">Conclusion</h3>

<p> While a trajectory formulated in the RKHS is easier to optimize the approach is still very sensitive to the hyper parameters.  </p>





<!--
<h3 class="mt-5 mb-3">Code Block Example</h3>
<p>You can get more info at <a class="text-link" href="https://highlightjs.org/" target="_blank">https://highlightjs.org/</a>. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. </p>
<pre>
	<code>
function $initHighlight(block, cls) {
  try {
    if (cls.search(/\bno\-highlight\b/) != -1)
      return process(block, true, 0x0F) +
             ` class="${cls}"`;
  } catch (e) {
    /* handle exception */
  }
  for (var i = 0 / 2; i < classes.length; i++) {
    if (checkCondition(classes[i]) === undefined)
      console.log('undefined');
  }
}

export  $initHighlight;
	</code>
</pre>


<h3 class="mt-5 mb-3">Typography</h3>
<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p>
<h5 class="my-3">Bullet Points:</h5>
<ul class="mb-5">
	<li class="mb-2">Lorem ipsum dolor sit amet consectetuer.</li>
	<li class="mb-2">Aenean commodo ligula eget dolor.</li>
	<li class="mb-2">Aenean massa cum sociis natoque penatibus.</li>
</ul>
<ol class="mb-5">
	<li class="mb-2">Lorem ipsum dolor sit amet consectetuer.</li>
	<li class="mb-2">Aenean commodo ligula eget dolor.</li>
	<li class="mb-2">Aenean massa cum sociis natoque penatibus.</li>
</ol>
<h5 class="my-3">Quote Example:</h5>
<blockquote class="blockquote m-lg-5 py-3   ps-4 px-lg-5">
	<p class="mb-2">You might not think that programmers are artists, but programming is an extremely creative profession. It's logic-based creativity.</p>
	<footer class="blockquote-footer mt-0">John Romero</footer>
</blockquote>

<h5 class="my-3">Table Example:</h5>
<table class="table table-striped my-5">
	<thead>
		<tr>
			<th scope="col">#</th>
			<th scope="col">First</th>
			<th scope="col">Last</th>
			<th scope="col">Handle</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<th scope="row">1</th>
			<td>Mark</td>
			<td>Otto</td>
			<td>@mdo</td>
		</tr>
		<tr>
			<th scope="row">2</th>
			<td>Jacob</td>
			<td>Thornton</td>
			<td>@fat</td>
		</tr>
		<tr>
			<th scope="row">3</th>
			<td>Larry</td>
			<td>the Bird</td>
			<td>@twitter</td>
		</tr>
	</tbody>
</table>

<h5 class="mb-3">Embed A Tweet:</h5>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">1969:<br>-what&#39;re you doing with that 2KB of RAM?<br>-sending people to the moon<br><br>2017:<br>-what&#39;re you doing with that 1.5GB of RAM?<br>-running Slack</p>&mdash; I Am Devloper (@iamdevloper) <a href="https://twitter.com/iamdevloper/status/926458505355235328?ref_src=twsrc%5Etfw">November 3, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>



<h3 class="mt-5 mb-3">Video Example</h3>
<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. </p>

<div class="ratio ratio-16x9">
	<iframe width="560" height="315" src="https://www.youtube.com/embed/1nxSE0R27Gg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>					
</div>

</div>
 -->
				
	<nav class="blog-nav nav nav-justified my-5">
		<a class="nav-link-top nav-item nav-link rounded" href="#">Back to Start<i class="arrow-prev fas fa-long-arrow-alt-up"></i><i class="arrow-next fas fa-long-arrow-alt-up"></i></a>
	</nav>
	
</div><!--//container-->
</article>
	
	
<footer class="footer text-center py-2 theme-bg-dark">
	
	<!--/* This template is free as long as you keep the footer attribution link. If you'd like to use the template without the attribution link, you can buy the commercial license via our website: themes.3rdwavemedia.com Thank you for your support. :) */-->
	<small class="copyright">Blog based on template by <a href="https://themes.3rdwavemedia.com" target="_blank">Xiaoying Riley</a></small>
	
</footer>

</div><!--//main-wrapper-->
    

        
       
<!-- Javascript -->          
<script src="assets/plugins/popper.min.js"></script> 
<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script> 

<!-- Page Specific JS -->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>

<!-- Custom JS -->
<script src="assets/js/blog.js"></script> 


</body>
</html> 

